---
import '../styles/global.css';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';

interface Props {
  title: string;
  description: string;
  canonicalURL?: string;
  ogImage?: string;
  schema?: object;
}

const { 
  title, 
  description, 
  canonicalURL = Astro.url.href,
  ogImage = 'https://wildchildcafe.in/images/og-image.jpg',
  schema
} = Astro.props;

const siteTitle = `${title} | Wild Child Cafe`;
const siteName = 'Wild Child Cafe';

// Absolute OG image URL
const absoluteOgImage = ogImage.startsWith('http') 
  ? ogImage 
  : `https://wildchildcafe.in${ogImage}`;

const schemaData = schema || null;
---

<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Preconnect Critical Origins -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  
  <!-- SEO Meta -->
  <title>{siteTitle}</title>
  <meta name="description" content={description} />
  <meta name="author" content="Wild Child Cafe" />
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
  <link rel="canonical" href={canonicalURL} />
  <meta name="geo.region" content="IN-TN" />
  <meta name="geo.placename" content="Samudram" />
  
  <!-- Open Graph -->
  <meta property="og:type" content="restaurant" />
  <meta property="og:title" content={siteTitle} />
  <meta property="og:description" content={description} />
  <meta property="og:image" content={absoluteOgImage} />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:url" content={canonicalURL} />
  <meta property="og:site_name" content={siteName} />
  <meta property="og:locale" content="en_IN" />
  <meta property="place:location:latitude" content="12.0" />
  <meta property="place:location:longitude" content="79.5" />
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={siteTitle} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={absoluteOgImage} />
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="apple-touch-icon" href="/favicon.svg" />
  <meta name="theme-color" content="#4A5D3A" />
  <meta name="msapplication-TileColor" content="#4A5D3A" />
  
  <!-- Fonts — Cormorant Garamond (editorial display) + Inter (body) -->
  <link 
    rel="preload" 
    href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500;1,600&family=Inter:wght@300;400;500;600&display=swap" 
    as="style" 
  />
  <link 
    href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500;1,600&family=Inter:wght@300;400;500;600&display=swap" 
    rel="stylesheet" 
    media="print"
    onload="this.media='all'"
  />
  <noscript>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500;1,600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />
  </noscript>

  <!-- Schema.org Structured Data -->
  {schemaData && (
    <script type="application/ld+json" set:html={JSON.stringify(schemaData)} />
  )}
  
  <!-- Security Headers -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="X-Frame-Options" content="SAMEORIGIN" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />

  <!-- Preload LCP image -->
  <link rel="preload" href="/images/hero-bg.png" as="image" fetchpriority="high" />
</head>
<body class="bg-cream text-charcoal">
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <Navbar />
  
  <main id="main-content">
    <slot />
  </main>
  
  <Footer />

  <!-- Scroll Reveal Observer — deferred, minimal JS -->
  <script>
    // Use requestIdleCallback for non-critical IntersectionObserver setup
    const initReveal = () => {
      const targets = document.querySelectorAll('.reveal, .reveal-left, .reveal-right, .reveal-scale');
      if (!targets.length) return;
      
      const observer = new IntersectionObserver((entries) => {
        for (const entry of entries) {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            observer.unobserve(entry.target);
          }
        }
      }, {
        threshold: 0.1,
        rootMargin: '0px 0px -40px 0px'
      });

      for (const el of targets) observer.observe(el);
    };

    if ('requestIdleCallback' in window) {
      requestIdleCallback(initReveal);
    } else {
      document.addEventListener('DOMContentLoaded', initReveal);
    }
  </script>
</body>
</html>
